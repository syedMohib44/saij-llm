services:
  training:
    build: .                 # ✅ Forces local build
    working_dir: /app
    volumes:
      - .:/app               # ✅ Mounts current folder into container
    command: python train.py
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
  
  testing:
    build: .                 # ✅ Use the local Blackwell-compatible Dockerfile
    working_dir: /app        # ✅ Set the context for where python runs
    volumes:
      - .:/app               # ✅ Map your host files (including test.py) into the container
    command: python test.py
    depends_on:
      training:
        condition: service_completed_successfully
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]